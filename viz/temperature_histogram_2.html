<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🌍 Data Meets Art – Réchauffement global (1880 → 2025)</title>
  <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
  <style>
    body {
      background: radial-gradient(circle at center, #050505, #000);
      color: #fff;
      font-family: 'Inter', sans-serif;
      text-align: center;
      margin: 0;
      padding: 10px;
      overflow-x: hidden;
    }
    h1 {
      font-weight: 300;
      margin-bottom: 5px;
      font-size: 1.2rem;
    }
    p {
      color: #aaa;
      font-size: 12px;
      margin-bottom: 10px;
    }
    #chart {
      width: 100%;
      height: 70vh;
      margin: auto;
      box-shadow: 0 0 20px rgba(0, 150, 255, 0.2);
      border-radius: 15px;
    }
  </style>
</head>

<body>
  <div class="navbar">
  <a href="../index.html" class="logo">🌍 Data Meets Art</a>
  <div class="nav-links">
    <a href="../index.html">Home</a>
    <a href="co2.html">Visualizations</a>
    <a href="viz/temperature_spiral.html" class="button">🌡️ See the Global Warming Spiral</a> |
    <a href="viz/temperature_histogram.html" class="button">🌡️ See the Global Warming Histogram</a> |
    <a href="viz/temperature_histogram_2.html" class="button">🌡️ See the Global Warming Histogram 2</a> |
    <a href="../about.html">About</a>
  </div>
</div>
  <h1>🌡️ L’évolution du climat depuis 1880</h1>
  <p>Source : NASA GISTEMP – Anomalies Terre + Océan</p>
  <div id="chart"></div>

  <script>
  async function drawHistogram() {
    const url = "../data/GLB.Ts+dSST.csv";
    const response = await fetch(url);
    const text = await response.text();

    const lines = text.split("\n").filter(l => /^\d{4}/.test(l));
    const months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

    const labels = [];
    const values = [];

    for (const line of lines) {
      const cols = line.split(",");
      const year = parseInt(cols[0]);
      for (let i = 1; i <= 12; i++) {
        const val = parseFloat(cols[i]);
        if (!isNaN(val)) {
          labels.push(`${year}-${months[i - 1]}`);
          values.push(val);
        }
      }
    }

    const trace = {
      x: labels.map((_, i) => i),
      y: new Array(labels.length).fill(null),
      type: "bar",
      marker: {
        color: new Array(labels.length).fill("rgba(255,255,255,0)"),
        line: { width: 0 }
      }
    };

    const layout = {
      paper_bgcolor: "#000",
      plot_bgcolor: "#000",
      font: { color: "#fff", size: 10 },
      margin: { t: 50, b: 50, l: 40, r: 20 },
      yaxis: { title: "Anomalie (°C)", range: [-2, 2], gridcolor: "#222", titlefont: { size: 12 } },
      xaxis: {
        title: "Année",
        range: [0, labels.length],
        tickangle: -45,
        tickvals: Array.from({length: 6}, (_, i) => i * 270), // moins de ticks pour mobile
        ticktext: Array.from({length: 6}, (_, i) => 1880 + i * 24),
        showgrid: false,
        titlefont: { size: 12 }
      },
      title: {
        text: "🌍 Données NASA GISTEMP – Températures mensuelles globales",
        font: { size: 14 }
      }
    };

    Plotly.newPlot("chart", [trace], layout, { responsive: true });

    let current = 0;
    const y = new Array(labels.length).fill(null);
    const colors = new Array(labels.length).fill("rgba(255,255,255,0)");

    function animateStep() {
      if (current >= labels.length) return;

      const val = values[current];
      y[current] = val;
      const intensity = Math.min(1, Math.abs(val) / 2);
      const alpha = 0.3 + 0.7 * intensity;
      colors[current] = val >= 0
        ? `rgba(${255 * intensity + 100}, ${80 * (1 - intensity)}, ${50}, ${alpha})`
        : `rgba(${80}, ${150 * (1 - intensity) + 50}, ${255 * intensity + 100}, ${alpha})`;

      Plotly.animate(
        "chart",
        { data: [{ y, marker: { color: colors } }] },
        {
          transition: { duration: 50, easing: "linear" },
          frame: { duration: 50, redraw: false }
        }
      );

      current++;
    }

    setInterval(animateStep, 30);
  }

  window.addEventListener("load", drawHistogram);
  </script>
</body>
</html>

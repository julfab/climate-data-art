<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸŒ¡ï¸ Ã‰volution des tempÃ©ratures (1880 â†’ 2025)</title>
  <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
  <style>
    body {
      background: radial-gradient(circle at center, #0d1117, #000);
      color: white;
      font-family: 'Inter', sans-serif;
      text-align: center;
      margin: 0;
      padding: 20px;
    }
    #chart {
      width: 95%;
      height: 80vh;
      margin: auto;
    }
  </style>
</head>

<body>
<div class="navbar">
  <a href="../index.html" class="logo">ğŸŒ Data Meets Art</a>
  <div class="nav-links">
    <a href="../index.html">Home</a>
    <a href="co2.html">Visualizations</a>
    <a href="temperature_spiral.html" class="button">ğŸŒ¡ï¸ See the Global Warming Spiral</a> |
    <a href="temperature_histogram.html" class="button">ğŸŒ¡ï¸ See the Global Warming Histogram</a> |
    <a href="temperature_histogram_2.html" class="button">ğŸŒ¡ï¸ See the Global Warming Histogram 2</a> |
    <a href="../about.html">About</a>
  </div>
</div>
  
  <h1>ğŸŒ Anomalies mensuelles de tempÃ©rature (1880 â†’ 2025)</h1>
  <p style="color:#ccc;">Source : NASA GISTEMP â€“ TempÃ©ratures Terre + OcÃ©an</p>
  <div id="chart"></div>

  <script>
  async function drawHistogram() {
    // ğŸ”¹ Lecture locale du CSV (dossier /data)
    const url = "../data/GLB.Ts+dSST.csv";
    const response = await fetch(url);
    const text = await response.text();

    // ğŸ”¹ Extraction des lignes correspondant Ã  une annÃ©e
    const lines = text.split("\n").filter(l => /^\d{4}/.test(l));
    const months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

    const labels = [];
    const values = [];

    for (const line of lines) {
      const cols = line.split(",");
      const year = parseInt(cols[0]);
      for (let i = 1; i <= 12; i++) {
        const val = parseFloat(cols[i]);
        if (!isNaN(val)) {
          labels.push(`${year}-${months[i - 1]}`);
          values.push(val);
        }
      }
    }

    console.log("âœ… DonnÃ©es chargÃ©es :", labels.length, "points");

    // ğŸ”¹ ParamÃ¨tres de la fenÃªtre animÃ©e
    const windowSize = 50; // nombre de barres affichÃ©es simultanÃ©ment
    let current = 0;

    // ğŸ”¹ Axe fixe sur toute la pÃ©riode
    const layout = {
      paper_bgcolor: "#0d1117",
      plot_bgcolor: "#0d1117",
      font: { color: "#fff" },
      margin: { t: 60, b: 80 },
      yaxis: { title: "Anomalie (Â°C)", range: [-2, 2] },
      xaxis: {
        title: "AnnÃ©e",
        range: [0, labels.length],
        tickangle: -45,
        showgrid: false,
        showline: false
      },
      title: {
        text: `ğŸŒ¡ï¸ Ã‰volution des anomalies de tempÃ©rature (FenÃªtre de ${windowSize} mois)`,
        font: { size: 18 }
      },
      transition: { duration: 0 }
    };

    // ğŸ”¹ Premier affichage vide
    const trace = {
      x: [],
      y: [],
      type: "bar",
      marker: { color: [] }
    };

    Plotly.newPlot("chart", [trace], layout, { responsive: true });

    // ğŸ”¹ Animation progressive
    const totalFrames = labels.length - windowSize;
    function animateStep() {
      const start = current;
      const end = current + windowSize;

      const x = labels.map((_, i) => i); // positions fixes
      const y = new Array(labels.length).fill(null); // on vide tout
      const colors = new Array(labels.length).fill("rgba(255,255,255,0)");

      // on ne remplit que la zone active
      for (let i = start; i < end; i++) {
        y[i] = values[i];
        colors[i] = values[i] >= 0
          ? "rgba(255,90,60,0.9)"
          : "rgba(80,130,255,0.9)";
      }

      Plotly.animate(
        "chart",
        { data: [{ x, y, marker: { color: colors } }] },
        {
          transition: { duration: 100, easing: "linear" },
          frame: { duration: 100, redraw: false }
        }
      );

      current = (current + 1) % totalFrames;
    }

    // Lancement de lâ€™animation
    setInterval(animateStep, 100);
  }

  window.addEventListener("load", drawHistogram);
  </script>
</body>
</html>
